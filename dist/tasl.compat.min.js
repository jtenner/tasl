(function(a,b){'object'==typeof exports&&'object'==typeof module?module.exports=b(require('pegjs')):'function'==typeof define&&define.amd?define(['pegjs'],b):'object'==typeof exports?exports.tasl=b(require('pegjs')):a.tasl=b(a.pegjs)})(this,function(a){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a['default']}:function(){return a};return b.d(c,'a',c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p='',b(b.s=5)}([function(a){'use strict';a.exports=function(a){return{Type:'Rule',Name:a,generate:function(a){return{value:' '+a+':'+this.Name,toString:function(){return this.value+' _'}}}}}},function(a){'use strict';a.exports={type:'Current',generate:function(a,b,c){return{value:' '+a+':'+c,toString:function(){return this.value+' _'}}}}},function(a){'use strict';a.exports={Type:'Next',generate:function(a,b){return{value:' '+a+':'+b,toString:function(){return this.value+' _'}}}}},function(a){'use strict';a.exports=function(a){var b=1<arguments.length&&arguments[1]!==void 0&&arguments[1];return{Type:'Literal',Value:a,Insensitive:b,generate:function(a){return{value:' '+a+':"'+this.Value.replace(/"/g,'\\"')+'"'+(this.Insensitive?'i':''),toString:function(){return this.value+' _'}}}}}},function(a,b,c){'use strict';function d(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function e(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var f=function(){function a(a,b){var c,d=[],e=!0,f=!1;try{for(var g,h=a[Symbol.iterator]();!(e=(g=h.next()).done)&&(d.push(g.value),!(b&&d.length===b));e=!0);}catch(a){f=!0,c=a}finally{try{!e&&h['return']&&h['return']()}finally{if(f)throw c}}return d}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),g=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c(13);a.exports=function(){function a(b,c){e(this,a),this.grammar=b,this.parser=h.generate(b),this.parser.handler=c}return g(a,[{key:'evaluate',value:function(a){for(var b=arguments.length,c=Array(1<b?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];return this.evaluateStatements.apply(this,[this.parser.parse(a)].concat(c))}},{key:'evaluateStatements',value:function(a){for(var b,c,d=arguments.length,e=Array(1<d?d-1:0),g=1;g<d;g++)e[g-1]=arguments[g];var h,i=!0,j=!1;try{for(var k,l=a[Symbol.iterator]();!(i=(k=l.next()).done);i=!0){var m=k.value,n=m.evaluate.apply(m,e),o=f(n,2);if(b=o[0],c=o[1],'return'===b)return c}}catch(a){j=!0,h=a}finally{try{!i&&l.return&&l.return()}finally{if(j)throw h}}return c}},{key:'evaluateAsync',value:async function(a,b){return this.evaluateStatementsAsync.apply(this,[this.parser.parse(a)].concat(d(b)))}},{key:'evaluateStatementsAsync',value:async function(a){for(var b,c,d=arguments.length,e=Array(1<d?d-1:0),g=1;g<d;g++)e[g-1]=arguments[g];var h,i=!0,j=!1;try{for(var k,l=a[Symbol.iterator]();!(i=(k=l.next()).done);i=!0){var m=k.value,n=await m.evaluate.apply(m,e),o=f(n,2);if(b=o[0],c=o[1],'return'===b)return c}}catch(a){j=!0,h=a}finally{try{!i&&l.return&&l.return()}finally{if(j)throw h}}return c}}]),a}()},function(a,b,c){'use strict';a.exports={Current:c(1),evaluateExpressions:c(6),evaluateExpressionsAsync:c(7),evaluateStatements:c(8),evaluateStatementsAsync:c(9),Expression:c(10),ExpressionList:c(11),Grammar:c(12),Identifier:c(15),IdentifierList:c(16),Integer:c(17),Interpreter:c(4),Literal:c(3),Next:c(2),Optional:c(18),Or:c(19),RequiredWhitespace:c(20),Rule:c(0),Statement:c(21),StatementList:c(22)}},function(a){'use strict';a.exports=function(a){for(var b=arguments.length,c=Array(1<b?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];var e,f,g=!0,h=!1;try{for(var i,j,k=a[Symbol.iterator]();!(g=(i=k.next()).done);g=!0)j=i.value,e=j.evaluate.apply(j,c)}catch(a){h=!0,f=a}finally{try{!g&&k.return&&k.return()}finally{if(h)throw f}}return e}},function(a){'use strict';a.exports=async function(a){for(var b=arguments.length,c=Array(1<b?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];var e,f=null,g=!0,h=!1;try{for(var i,j,k=a[Symbol.iterator]();!(g=(i=k.next()).done);g=!0)j=i.value,f=await j.evaluate.apply(j,c)}catch(a){h=!0,e=a}finally{try{!g&&k.return&&k.return()}finally{if(h)throw e}}return f}},function(a){'use strict';var b=function(){function a(a,b){var c,d=[],e=!0,f=!1;try{for(var g,h=a[Symbol.iterator]();!(e=(g=h.next()).done)&&(d.push(g.value),!(b&&d.length===b));e=!0);}catch(a){f=!0,c=a}finally{try{!e&&h['return']&&h['return']()}finally{if(f)throw c}}return d}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}();a.exports=function(a){for(var c=arguments.length,d=Array(1<c?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];var f,g,h,i=!0,j=!1;try{for(var k,l=a[Symbol.iterator]();!(i=(k=l.next()).done);i=!0){var m=k.value,n=m.evaluate.apply(m,d),o=b(n,2);if(f=o[0],g=o[1],'return'===f)return[f,g]}}catch(a){j=!0,h=a}finally{try{!i&&l.return&&l.return()}finally{if(j)throw h}}return[null,g]}},function(a){'use strict';var b=function(){function a(a,b){var c,d=[],e=!0,f=!1;try{for(var g,h=a[Symbol.iterator]();!(e=(g=h.next()).done)&&(d.push(g.value),!(b&&d.length===b));e=!0);}catch(a){f=!0,c=a}finally{try{!e&&h['return']&&h['return']()}finally{if(f)throw c}}return d}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}();a.exports=async function(a){for(var c=arguments.length,d=Array(1<c?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];var f,g,h,i=!0,j=!1;try{for(var k,l=a[Symbol.iterator]();!(i=(k=l.next()).done);i=!0){var m=k.value,n=await m.evaluate.apply(m,d),o=b(n,2);if(f=o[0],g=o[1],'return'===f)return[f,g]}}catch(a){j=!0,h=a}finally{try{!i&&l.return&&l.return()}finally{if(j)throw h}}return[null,g]}},function(a,b,c){'use strict';a.exports=c(0)('Expression')},function(a,b,c){'use strict';a.exports=c(0)('ExpressionList')},function(a,b,c){'use strict';function d(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var e=function(){function a(a,b){var c,d=[],e=!0,f=!1;try{for(var g,h=a[Symbol.iterator]();!(e=(g=h.next()).done)&&(d.push(g.value),!(b&&d.length===b));e=!0);}catch(a){f=!0,c=a}finally{try{!e&&h['return']&&h['return']()}finally{if(f)throw c}}return d}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),f=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(0),h=c(2),i=c(1),j=c(3),k=c(4);a.exports=function(){function a(){d(this,a),this.counts={E:-1,S:-1,C:-1,L:-1},this.handler={E:{},S:{},C:{}},this.keywords=[],this.terminator=';',this.grammar=c(14)}return f(a,[{key:'setTerminator',value:function(a){return this.terminator=a,this}},{key:'addBinaryExpression',value:function(a){return this.addRule({Alias:a.Alias,Tokens:[['left',a.Left||h],['operator',j(a.Operator)],['right',a.Right||i]],Type:'E',Handler:a.Handler})}},{key:'addUnaryExpression',value:function(a){return this.addRule({Alias:a.Alias,Tokens:'right'===a.Type?[['expression',a.Expression||h],['operator',j(a.Operator)]]:[['operator',j(a.Operator)],['expression',a.Expression||i]],Type:'E',Handler:a.Handler})}},{key:'addExpression',value:function(a){var b=a.Alias,c=a.Tokens,d=a.Handler;return this.addRule({Alias:b,Tokens:c,Type:'E',Handler:d})}},{key:'addStatement',value:function(a){var b=a.Alias,c=a.Tokens,d=a.Handler;return this.addRule({Alias:b,Tokens:c,Type:'S',Handler:d})}},{key:'addCustom',value:function(a){var b=a.Alias,c=a.Tokens,d=a.Handler;return this.addRule({Alias:b,Tokens:c,Type:'C',Handler:d})}},{key:'addRule',value:function(a){var b=a.Alias,c=a.Tokens,d=a.Type,e=a.Handler;this.counts[d]+=1;var f=''+d+this.counts[d];this.handler[d][f]=e;var g=''+d+(this.counts[d]+1);return this.grammar+='\n'+(b?b+' = '+f+'\n':'')+f+' = '+this.spliceTokens(c,g,f)+' {\n  return {\n    alias: "'+b+'",\n    nodeType: "'+d+'",\n    type: "'+f+'",\n    evaluate,\n    props: { '+c.map(function(a){return a[0]}).join(', ')+' },\n    text: text(),\n    location: location()\n  };\n} '+('S'===d||'E'===d?'/ '+g:'')+'\n',this}},{key:'addList',value:function(a){this.counts.L+=1;var b='L'+this.counts.L,c=a.Terminator?'_ "'+a.Terminator.replace(/"/g,'\\"')+'" ':'';return this.grammar+='\n'+b+' = '+a.Rule+'\n'+a.Alias+' = first:'+b+' last:('+c+' _ '+b+')* '+(a.Terminator?c+'?':'')+' {\n  return [first, ...last.map(x => x['+(a.Terminator?3:1)+'])];\n}\n',this}},{key:'spliceTokens',value:function(a,b,c){for(var d='',f=0;f<a.length;f++){var g=e(a[f],2),h=g[0],i=g[1];d+=(i.constructor===String?j(i):i).generate(h,b,c).toString()}return d}},{key:'reserve',value:function(){var a;return(a=this.keywords).push.apply(a,arguments),this}},{key:'generate',value:function(){return this.grammar+='\n\nE'+(this.counts.E+1)+' = ExpressionExit\nS'+(this.counts.S+1)+' = StatementExit\n\n'+(this.keywords.length?'Keyword = ('+this.keywords.map(function(a){return'"'+a.replace(/"/g,'\\"')+'"'}).join(' / ')+')':'Keyword = "1"')+' \nTerminator = "'+this.terminator+'"\n',new k(this.grammar,this.handler)}}]),a}()},function(b){b.exports=a},function(a){a.exports='{\r\n  const { handler } = this;\r\n\r\n  function evaluate(...context) {\r\n    return handler[this.nodeType][this.type](this.props, ...context);\r\n  }\r\n  handler.S.SExpressionStatement = function SExpressionStatement({ expressions }, ...context) {\r\n    let value;\r\n    for(const expression of expressions) {\r\n      value = expression.evaluate(...context);\r\n    }\r\n    return [null, value];\r\n  };\r\n  handler.E.EReturnValue = function EReturnValue({ value }) { return value; }\r\n}\r\n\r\nProgram = _ statements:StatementList _ {\r\n  return statements;\r\n}\r\n\r\nStatementList = first:Statement last:(_ Statement)* {\r\n  return [first, ...last.map(x => x[1])];\r\n}\r\nExpressionList = first:Expression last:(_ \',\' _ Expression)* {\r\n  return [first, ...last.map(x => x[3])];\r\n}\r\nIdentifier = !Keyword [a-zA-Z$_][a-zA-Z$_0-9]* {\r\n  return {\r\n    nodeType: \'I\',\r\n    type: \'Identifier\',\r\n    value: text(),\r\n    text: text(),\r\n    location: location()\r\n  };\r\n}\r\nIdentifierList = first:Identifier last:(_ "," _ Identifier)* {\r\n  return [first, ...last.map(x => x[3])];\r\n}\r\n\r\nStatement = S0\r\nExpression = E0\r\n\r\nExpressionExit = Float\r\n\r\nFloat = [0-9]+ "." [0-9]+ {\r\n  return {\r\n    nodeType: \'E\',\r\n    type: \'EReturnValue\',\r\n    evaluate,\r\n    props: {\r\n      value: parseFloat(text()),\r\n    },\r\n    text: text(),\r\n    location: location()\r\n  };\r\n} / Integer\r\n\r\nInteger = [0-9]+ {\r\n  return {\r\n    nodeType: \'E\',\r\n    type: \'EReturnValue\',\r\n    evaluate,\r\n    props: {\r\n      value: parseInt(text(), 10),\r\n    },\r\n    text: text(),\r\n    location: location()\r\n  };\r\n} / Null\r\n\r\nNull = "null" {\r\n  return {\r\n    nodeType: \'E\',\r\n    type: \'EReturnValue\',\r\n    evaluate,\r\n    props: {\r\n      value: null,\r\n    },\r\n    text: text(),\r\n    location: location()\r\n  };\r\n}\r\n\r\nStatementExit = ExpressionStatement\r\n\r\nExpressionStatement = expressions:ExpressionList _ Terminator? {\r\n  return {\r\n    alias: \'ExpressionStatement\',\r\n    nodeType: "S",\r\n    type: \'SExpressionStatement\',\r\n    evaluate,\r\n    props: { expressions },\r\n    text: text(),\r\n    location: location()\r\n  };\r\n}\r\n\r\n_ = [\\t\\r\\n ]*\r\n__ = [\\t\\r\\n ]+'},function(a,b,c){'use strict';a.exports=c(0)('Identifier')},function(a,b,c){'use strict';var d=c(0);a.exports=d('IdentifierList')},function(a){'use strict';a.exports={Type:'Integer',generate:function(a){return{value:' '+a+':[0-9]+',toString:function(){return this.value+' _'}}}}},function(a){'use strict';a.exports=function(a){return{Type:'Optional',generate:function(b,c,d){return{value:' '+b+':('+a.generate(b+'_',c,d).value+')?',toString:function(){return this.value+' _'}}}}}},function(a){'use strict';a.exports=function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return{type:'Or',generate:function(a,c,d){return{value:' '+a+':('+b.map(function(b,e){return b.generate(a+e,c,d).value}).join(' / ')+')',toString:function(){return this.value+' _'}}}}}},function(a){'use strict';a.exports={Type:'RequiredWhitespace',generate:function(){return{toString:function(){return'_'}}}}},function(a,b,c){'use strict';a.exports=c(0)('Statement')},function(a,b,c){'use strict';a.exports=c(0)('StatementList')}])});